var ExpressCheckout={completedSteps:new Array,currentStep:"AccountDetails",signedIn:0,digitalOrder:0,createAccount:0,anonymousCheckout:0,checkoutLogin:0,init:function(){"none"==$("#CheckoutStepAccountDetails").css("display")?ExpressCheckout.currentStep="BillingAddress":$("#BillingDetailsLabel").html(lang.ExpressCheckoutStepBillingAccountDetails),$(".ExpressCheckoutBlock").hover(function(){$(this).hasClass("ExpressCheckoutBlockCompleted")&&$(this).css("cursor","pointer")},function(){$(this).css("cursor","default")}),$(".ExpressCheckoutBlock").click(function(){$(this).hasClass("ExpressCheckoutBlockCompleted")&&$(this).find(".ChangeLink").click()}),$(document).ajaxError(function(e,t,s){ExpressCheckout.HideLoadingIndicators(),alert(lang.ExpressCheckoutLoadError)})},Login:function(){return $("#CheckoutLoginError").hide(),ExpressCheckout.anonymousCheckout=0,ExpressCheckout.createAccount=0,0==ExpressCheckout.validateEmailAddress($("#login_email").val())?(alert(lang.LoginEnterValidEmail),$("#login_email").focus(),$("#login_email").select(),!1):""==$("#login_pass").val()?(alert(lang.LoginEnterPassword),$("#login_pass").focus(),!1):(ExpressCheckout.ShowLoadingIndicator("#LoginForm"),$.ajax({url:"remote.php",type:"post",dataType:"json",data:"w=expressCheckoutLogin&"+$("#LoginForm").serialize(),success:ExpressCheckout.HandleResponse}),!1)},HandleResponse:function(e){ExpressCheckout.HideLoadingIndicators(),void 0!=e.completedSteps&&$.each(e.completedSteps,function(){var e=document.createTextNode(this.message);$("#CheckoutStep"+this.id+" .ExpressCheckoutCompletedContent").html(e),$("#CheckoutStep"+this.id).addClass("ExpressCheckoutBlockCompleted"),ExpressCheckout.completedSteps[ExpressCheckout.completedSteps.length]=this.id}),void 0!=e.stepContent&&$.each(e.stepContent,function(){$("#CheckoutStep"+this.id+" .ExpressCheckoutContent").html(this.content),$("#CheckoutStep"+this.id+" .ExpressCheckoutContent .FormField.JSHidden").show()}),ExpressCheckout.HandleResponseStatus(e)},HandleResponseStatus:function(e){if(0==e.status&&(e.errorContainer?$(e.errorContainer).html(e.errorMessage).show():alert(e.errorMessage)),e.changeStep&&(ExpressCheckout.ChangeStep(e.changeStep),ExpressCheckout.ResetNextSteps()),e.focus)try{$(e.focus).focus().select()}catch(t){}},GuestCheckout:function(){$("#CreateAccountForm").show(),$("#CheckoutLoginError").hide(),"none"==$("#CheckoutGuestForm").css("display")||$("#checkout_type_register:checked").val()?(type="account",ExpressCheckout.anonymousCheckout=0,ExpressCheckout.createAccount=1):(type="guest",ExpressCheckout.anonymousCheckout=1,ExpressCheckout.createAccount=0),ExpressCheckout.ShowLoadingIndicator("#CheckoutGuestForm"),$.ajax({url:"remote.php",type:"post",dataType:"json",data:{w:"expressCheckoutGetAddressFields",type:type},success:ExpressCheckout.HandleResponse})},ResetNextSteps:function(){steps=ExpressCheckout.GetSteps();var e=!1,t=Array();$.each(steps,function(s,o){o==ExpressCheckout.currentStep?(t[t.length]=o,e=!0):1==e&&($("#CheckoutStep"+o).removeClass("ExpressCheckoutBlockCompleted"),$("#CheckoutStep"+o+" .ExpressCheckoutCompletedContent").html(""))}),ExpressCheckout.completedSteps=t},ChangeStep:function(e){return"undefined"==typeof e&&(e=ExpressCheckout.CalculateNextStep(ExpressCheckout.currentStep)),e==ExpressCheckout.currentStep?!1:($("#CheckoutStep"+ExpressCheckout.currentStep+" .ExpressCheckoutContent").fadeOut("slow"),$("#CheckoutStep"+ExpressCheckout.currentStep).addClass("ExpressCheckoutBlockCollapsed"),-1!=$.inArray(ExpressCheckout.currentStep,ExpressCheckout.completedSteps)&&$("#CheckoutStep"+ExpressCheckout.currentStep).addClass("ExpressCheckoutBlockCompleted"),$("#CheckoutStep"+e+" .ExpressCheckoutContent").fadeIn("slow",function(){var e=$(this).find(".ExpressCheckoutTitle").is(":in-viewport");0==e&&(topAcc2=$(this).offset().top,$("html, body").animate({scrollTop:topAcc2-90},600))}),$("#CheckoutStep"+e).removeClass("ExpressCheckoutBlockCollapsed"),ExpressCheckout.currentStep=e,!1)},GetSteps:function(){var e=Array();return 0==ExpressCheckout.signedIn&&(e[e.length]="AccountDetails"),e[e.length]="BillingAddress",ExpressCheckout.digitalOrder||(e[e.length]="ShippingAddress",e[e.length]="ShippingProvider"),e[e.length]="Confirmation",e[e.length]="PaymentDetails",e},CalculateNextStep:function(e){steps=ExpressCheckout.GetSteps();var t="";return $.each(steps,function(s,o){o==e&&(t=steps[s+1])}),t?t:void 0},ChooseBillingAddress:function(){if($("#BillingAddressTypeExisting:checked").val()&&"none"!=$("#ChooseBillingAddress").css("display")){if(-1==$(".SelectBillingAddress select option:selected").val())return alert(lang.ExpressCheckoutChooseBilling),$(".SelectBillingAddress select").focus(),!1;addressType="existing"}else{if((ExpressCheckout.anonymousCheckout||ExpressCheckout.createAccount)&&!ExpressCheckout.ValidateNewAccount(!0))return!1;if(!ExpressCheckout.ValidateNewAddress("billing"))return!1;addressType="new"}return createAppend="",ExpressCheckout.createAccount&&(createAppend="&createAccount=1"),$("noscript").remove(),$.ajax({url:"remote.php",type:"post",dataType:"json",data:"w=saveExpressCheckoutBillingAddress&"+$("#NewBillingAddress").serialize()+"&BillingAddressType="+addressType+createAppend,success:ExpressCheckout.HandleResponse}),!1},ChooseShippingAddress:function(e){if($("#ShippingAddressTypeExisting:checked").val()&&"none"!=$("#ChooseShippingAddress").css("display")){if(-1==$(".SelectShippingAddress select option:selected").val())return alert(lang.ExpressCheckoutChooseShipping),$(".SelectShippingAddress select").focus(),!1;addressType="existing"}else{if(!ExpressCheckout.ValidateNewAddress("shipping"))return!1;addressType="new"}return $.ajax({url:"remote.php",type:"post",dataType:"json",data:"w=saveExpressCheckoutShippingAddress&"+$("#NewShippingAddress").serialize()+"&ShippingAddressType="+addressType,success:ExpressCheckout.HandleResponse}),!1},SetBillingAndShippingAddress:function(){return billingAddress=$(".SelectBillingAddress select option:selected").html().substring(0,58),$("#CheckoutStepBillingAddress .ExpressCheckoutCompletedContent").html(billingAddress+"..."),$("#CheckoutStepBillingAddress").addClass("ExpressCheckoutBlockCompleted"),ExpressCheckout.ChooseShippingAddress(),!1},ChooseShippingProvider:function(){var e=!0;return $("#CheckoutStepShippingProvider .ShippingProviderList").each(function(){return $(this).find("input[type=radio]:checked").val()?void 0:(alert(lang.ExpressCheckoutChooseShipper),$(this).find("input[type=radio]").get(0).focus(),e=!1,!1)}),0==e?!1:($.ajax({url:"remote.php",type:"post",dataType:"json",data:"w=saveExpressCheckoutShippingProvider&"+$("#CheckoutStepShippingProvider form").serialize(),success:ExpressCheckout.HandleResponse}),!1)},ShowLoadingIndicator:function(e){"undefined"==typeof e&&(e="body"),$(e).find(".ExpressCheckoutBlock input[type=submit]").each(function(){$(this).attr("oldValue",$(this).val()),$(this).val(lang.ExpressCheckoutLoading),$(this).attr("disabled",!0)}),$(e).find(".LoadingIndicator").show(),$("body").css("cursor","wait")},HideLoadingIndicators:function(){HideLoadingIndicator(),$(".ExpressCheckoutBlock input[type=submit]").each(function(){$(this).attr("oldValue")&&1==$(this).attr("disabled")&&($(this).val($(this).attr("oldValue")),$(this).attr("disabled",!1))}),$(".LoadingIndicator").hide(),$("body").css("cursor","default")},LoadOrderConfirmation:function(){postVars.w="expressCheckoutShowConfirmation",$.ajax({url:"remote.php",type:"post",dataType:"json",data:postVars,success:ExpressCheckout.HandleResponse})},HidePaymentForm:function(){$("#CheckoutStepPaymentDetails").hide(),$("#CheckoutStepPaymentDetails .ExpressCheckoutContent").html("")},LoadPaymentForm:function(e){$.ajax({url:"remote.php",data:"w=expressCheckoutLoadPaymentForm&"+$("#CheckoutStepConfirmation form").serialize(),dataType:"json",type:"post",success:ExpressCheckout.HandleResponse})},ShowSingleMethodPaymentForm:function(){$("#CheckoutStepPaymentDetails").show(),ShowContinueButton()},ValidateNewAccount:function(){for(var e,t,s=FormField.GetValues(CustomCheckoutFormNewAccount),o=0;o<s.length;o++){if("EmailAddress"==s[o].privateId&&0==ExpressCheckout.validateEmailAddress(s[o].value))return alert(lang.LoginEnterValidEmail),FormField.Focus(s[o].field),!1;if("Password"==s[o].privateId){if(!ExpressCheckout.createAccount)continue;e=s[o]}else if("ConfirmPassword"==s[o].privateId){if(!ExpressCheckout.createAccount)continue;t=s[o]}var r=FormField.Validate(s[o].field);if(!r.status)return alert(r.msg),FormField.Focus(s[o].field),!1}return ExpressCheckout.createAccount&&e&&e.value!==t.value?(alert(lang.AccountPasswordsDontMatch),FormField.Focus(t.field),!1):!0},BuildAddressLine:function(e){var t={FirstName:"",LastName:"",Company:"",AddressLine1:"",City:"",State:"",Zip:"",Country:""};if("billing"==e)var s=CustomCheckoutFormBillingAddress;else var s=CustomCheckoutFormShippingAddress;for(var o=FormField.GetValues(s),r="",n=0;n<o.length;n++)t[o[n].privateId]=o[n].value;for(var n in t){var i=t[n];""!==i&&(""!=r&&"LastName"!=n?r+=", ":"LastName"==n&&(r+=" "),r+=i)}return r},ValidateNewAddress:function(e,t){if(t!==!0&&(t=!1),"billing"==e)var s=CustomCheckoutFormBillingAddress;else var s=CustomCheckoutFormShippingAddress;for(var o=FormField.GetValues(s),r=!1,n=0;n<o.length;n++){var i=FormField.Validate(o[n].field);if(!i.status)return t||alert(i.msg),FormField.Focus(o[n].field),r=!0,!1}return 1==r?!1:!0},validateEmailAddress:function(e){return-1==e.indexOf("@")||-1==e.indexOf(".")?!1:!0},ToggleAddressType:function(e,t){"Select"==t?($(".Select"+e+"Address").show(),$(".Add"+e+"Address").hide()):($(".Add"+e+"Address").show(),$(".Select"+e+"Address").hide())},ConfirmPaymentProvider:function(){if("none"!=$(".CheckoutHideOrderTermsAndConditions").css("display")&&1!=$("#AgreeTermsAndConditions").prop("checked"))return alert(lang.TickArgeeTermsAndConditions),!1;if(!confirm_payment_provider())return!1;var e="";if("none"!=$("#use_store_credit").css("display")&&$("#store_credit:checked").val()?"none"!=$("#credit_provider_list").css("display")&&(e=$("#credit_provider_list input:checked")):e=$("#provider_list input:checked"),""!=e&&$(e).hasClass("ProviderHasPaymentForm")){var t=$(".ProviderName"+e.val()).html();return $("#CheckoutStepConfirmation .ExpressCheckoutCompletedContent").html(t),ExpressCheckout.LoadPaymentForm($(e).val()),!1}return ExpressCheckout.HidePaymentForm(),!0},ApplyCouponCode:function(){return""==$("#couponcode").val()?(alert(lang.EnterCouponCode),$("#couponcode").focus(),!1):($.ajax({url:"remote.php",data:"w=getExpressCheckoutConfirmation&"+$("#CheckoutStepConfirmation form").serialize(),dataType:"json",type:"post",success:ExpressCheckout.HandleResponse}),!1)},UncheckPaymentProvider:function(){$("#provider_list input").each(function(){$(this).attr("checked",!1)})}};